<!DOCTYPE html>
<html>
    <head>
        <script src="https://fb.me/react-15.2.1.js"></script>
        <script src="https://fb.me/react-dom-15.2.1.js"></script>
        <script src="https://cdnjs.cloudflare.com/ajax/libs/babel-core/5.8.34/browser.js"></script>
        <script src="https://cdnjs.cloudflare.com/ajax/libs/fetch/1.0.0/fetch.js"></script>
        <script src="https://npmcdn.com/react-draggable"></script>
        <link rel="stylesheet" type="text/css" href="style.css">
        <title>Building the Note Board</title>
    </head>
    <body>
        <div id='react-container'></div>
        <script type="text/babel">

            var Note = React.createClass({

                getInitialState() {
                    return {
                        editing : false,
                    }
                },

                componentWillMount() {
                    this.style = {
                        right: this.randomBetween(0, window.innerWidth - 150, 'px'),
                        top: this.randomBetween(0, window.innerHeight - 150, 'px')
                    }
                },

                componentDidUpdate() {
                    console.log("update");
                    if (this.state.editing) {
                        this.refs.text.focus();
                        this.refs.text.select();
                    }
                },

                shouldComponentUpdate(nextProps, nextState) {
                    return this.props.children !== nextProps.children || this.state !== nextState;
                },

                randomBetween(x, y, s) {
                    return (x + Math.ceil(Math.random() *  (y-x))) +s;
                },

                edit() {
                    this.setState({ editing:true })
                },

                save() {
                    this.props.onUpdate(this.refs.text.value, this.props.id);
                    this.setState({ editing:false });
                },

                remove() {
                    this.props.onRemove(this.props.id);
                },

                renderForm() {
                    return (
                        <div className="note" style={this.style}>
                            <textarea ref="text" defaultValue={this.props.children}></textarea>
                            <span>
                                <button onClick={this.save}>SAVE</button>
                            </span>
                        </div>
                    )
                },

                renderDisplay() {
                    return (
                        <div className="note" style={this.style}>
                            <p>{this.props.children}</p>
                            <span>
                                <button onClick={this.edit}>EDIT</button>
                                <button onClick={this.remove}>X</button>
                            </span>
                        </div>
                    )
                },

                render() {
                    return (this.state.editing) ? this.renderForm() : this.renderDisplay() 
                }
            })

            var Board = React.createClass({

                propTypes: {
                    count: function (props, propName) {
                        if (typeof props[propName] !== "number") {
                            return new Error('Please enter a number')
                        }

                        if (props[propName] > 100) {
                            return new Error('below 100')
                        }
                    }
                },

                getInitialState() {
                    return {
                        notes: []
                    }
                },

                componentWillMount() {
                    if (this.props.count) {
                        var url = `https://baconipsum.com/api/?type=all-meat&sentences=${this.props.count}`
                        fetch(url)
                            .then(results => results.json())
                            .then(array => array[0])
                            .then(text => text.split('. '))
                            .then(array => array.forEach(
                                    sentence => this.add(sentence)))
                            .catch(function(err) {
                                console.log("Didn't connect to the API", err)
                            })
                    }
                },

                nextId() {
                    this.uniqueId = this.uniqueId || 0;
                    return this.uniqueId++;
                },

                add(text) {
                    var notes = [
                        ...this.state.notes,
                        {
                            id: this.nextId(),
                            note: text
                        }
                    ]
                    this.setState({notes});
                },

                update(text, id) {
                    var notes = this.state.notes.map(
                        note => ( (note.id !== id) ? note : { ...note , note: text } )
                    );
                    this.setState({notes});
                },

                remove(id) {
                    var notes = this.state.notes.filter(note => note.id !== id);
                    this.setState({notes});
                },

                createNote(value) {
                    return (<Note 
                                key={value.id}
                                id={value.id}
                                onUpdate={this.update}
                                onRemove={this.remove} >
                                {value.note}
                            </Note>);
                },

                render() {
                    return (
                        
                        <div className="board">
                        
                            {this.state.notes.map(this.createNote)}  {/* Displaying Notes */}

                            <button onClick={() => this.add("My note")}>+</button>  {/* For Adding New Notes */}
                        </div>
                    )
                }
            })

            ReactDOM.render(<Board count={10} />,document.getElementById('react-container'))
        

        </script>
    </body>
</html>




